<!DOCTYPE html>
<html lang="zh">
<head>
    <!--æ‰€æœ‰èµ„æºå†…ç½®ï¼Œé˜²æ­¢å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç¦»çº¿ä½¿ç”¨-->
    <link rel="icon" type="image/png"
          href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAASAAAAEgARslrPgAAA81JREFUSMfFVX9M1GUY/zzv9xBoZUOD407ix8TJESPazbLZpuRoOeXYISq6VMoYMAwDs8FtTm81xwIHkoVYMfLHULlxA3WluJDVFLfAtTGzYOMQPVBoBeFO7nv3Pv3T9yhuRP+Uzz/v9vl+nuf7vJ/P8+wFHnPQfAR9BsvUqqgoJdH3m1dfWCjCOI/TnE5pF9nUEBfHXv+wuKgoIovCqczl4rdpm3+XxcJeXbQsra8fKSDx8/Hx8bnqi7k+GF6fdpgirVZlndqm3unv509lBG0XQl7E86L88GGU8FdUvnUrLRV3eG1urnwFUdJbW8teTqP8kBBAbVHMAwOG8ekPkuOzsv51A8b06ZLkcxYLLaC1KHA44EAE71cUPEl78M3AAKawH4MZGUFSnkQuvlizhg7BiVKXi76Enq06Hb1Fu/mN1lbjpK8pqXjDhjktiClljikND/cn+ToWvmw2UxfZuTMszD8mJ9k6OqrxlEixkJzR0RoekoIEjiaS98Uvol6vpwpp9lc9eOArQ6e4JqXGRyu/I096PKJIt+Vhfm/v3RqiuzUez4zkqer3Jo/NZjR6vSYTc+D8QY01lRUVGdepu02JLlcAz1O3mIZPnzY+reabdjU3a7ihwVtiSnW7jVb1xSRHcfHseoYG9XJSZXl5sAXV/BTMmZlBEvVTMSKGhjDGlUiNjZ13qu2ohmowsEe+T0VudxAhgePoxMxM6AKJ7fQC4vv6+ADe5R3Dw4GEvXI9LR0ZYRsd4mUOx9/9u3ED3yEUXUJgHx3kDxUlYNVtui7EvXt+K3qlbGmZ+Q9q6cTEBADg1j9swf8VAQXYwjfhSkmhPCSQfeXKQMd1ogbbmppQKW10MycHbizAj0R4jbbjsqpiDNNYLQTsfJDsmzZpef5Ubufx5mY6SxZ6ZgbnJuwEdXfjKJYDf1XgPfodPefPz+6Ql/En+DUuDmbaCxoamu9G/DlVw+x2U7j4iOuNxiDCIA3xjra2GRv/jP96DXk1H6D0R4+U27qMyes9PdoaBhTQADojLwCLFmFKXsDiS5eUh/gYad3d4hrSSUlLw1XZiasdHcoSSiZTRYVsJL04YrNpuAxDvlK8YoWWp9Uhlo3+VRERs/c/aAjdnaF1tza3t/N6PotnN27knbhPTp8PU3wEryYmYhRVGL1yJUjaWjiR0tWFCbyEzNhYLY8b+Sidys52F4ae+WlJsMXzPkbRb7JMrIuMFPt8gyFfFxSIz7hUVra1yeX8BBbHx3MOnlNWCSFGaMzXNzjICu1RNlss/K0uwR9z7Nh8j9Fjjz8AOBDveuBBAwYAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDUtMDhUMTQ6MTY6NTUrMDg6MDDXwSKxAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA1LTA4VDE0OjE2OjU1KzA4OjAwppyaDQAAAEp0RVh0c3ZnOmJhc2UtdXJpAGZpbGU6Ly8vaG9tZS9hZG1pbi9pY29uLWZvbnQvdG1wL2ljb25fZTlidG03NXN0Zi9saXVsYW5xaS5zdmeLWds5AAAAAElFTkSuQmCC"/>
    <script>
        window.onerror = function () {
            alert('å‡ºé”™ï¼š\n' + JSON.stringify(arguments));
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
    </script>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>æµè§ˆå™¨åŠ©æ‰‹</title>
    <style>
        html, body, #body {
            width: 100%;
            height: 100%;
            display: block;
            margin: 0;
            padding: 0;
        }

        body {
            font-size: 62.5%;
        }

        #body * {
            font-size: 1rem;
        }

        #body {
            padding: 2.5rem 1rem 4rem 1rem;
        }

        button {
            border: 1px solid #007bff;
            background-color: #007bff;
            color: #fff;
            padding: .25rem .5rem;
            line-height: 1.5;
            border-radius: .2rem;
            box-sizing: border-box;
            display: inline-block;
            font-weight: 400;
            text-align: center;
            vertical-align: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        a {
            color: #007bff;
            text-decoration: none;
            font-weight: 400;
        }

        * {
            box-sizing: border-box;
        }


        input {
            display: inline-block;
            border: 1px solid #ced4da;
            height: calc(1.5em + .5rem + 2px);
            padding: .25rem .5rem;
            line-height: 1.5;
            border-radius: .2rem;
            font-weight: 400;
            color: #495057;
            background-color: #fff;
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        input[type="checkbox"] {
            display: inline-block;
            height: 1rem;
            width: 1rem;
            vertical-align: text-bottom;
        }

        .edit_title {
            text-align: center;
        }

        .editable {
            border: 0 none;
            border-bottom: 1px dotted black;
            outline: none;
            white-space: pre-wrap;
            background-color: transparent;
            display: block;
            text-align: center;
            width: 100%;
            margin-bottom: 1rem;
            border-radius: 10%;
        }

        .nav_bar {
            background-color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 0.5rem 0;
            border-top: 1px solid lightgray;
            border-radius: 100%;
            text-align: center;
            z-index: 1;
        }

        .nav_bar .split {
            display: inline-block;
            margin-right: 1rem;
        }

        input.search_url {
            border: 1px solid lightgrey;
            padding: 0;
            width: 4rem;
            border-radius: 6px;
            outline: none;
            text-align: center;
        }

        .nav_bar input, .nav_bar button {
            vertical-align: middle;
        }

        .float_div {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            overflow: hidden;
        }

        .float_div .holder_line {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            text-align: center;
        }

        .float_div .body {
            background-color: #eaeaea;
            border-radius: 10px 10px 0 0;
            box-sizing: border-box;
            text-align: left;
            white-space: nowrap;
            margin: 0 auto;
            overflow: auto;
        }

        .float_div .title {
            text-align: center;
            font-size: 1.4rem !important;
            position: absolute;
            top: 0;
            width: 100%;
            background-color: #eaeaea;
        }

        .float_div .content {
            text-align: center;
            margin: 3.4rem 0 5.7rem 0;
        }

        .float_div .buttons {
            text-align: center;
            white-space: nowrap;
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: #eaeaea;
            padding-bottom: 0.2rem;
        }


        .float_div .msg {
            margin-bottom: 0.5rem;
            text-align: center;
            font-style: italic;
        }


        .float_div .notice {
            color: orange;
        }

        .float_div .warning {
            color: #ff4400;
        }

        .float_div .error {
            color: red;
        }

        .float_div .success {
            color: green;
        }

        .float_div .float_btn {
            margin: 0 0.5rem;
        }

        .status_bar {
            z-index: 2;
            width: 100%;
            position: fixed;
            right: 0;
            top: 0;
            white-space: nowrap;
            overflow: auto hidden;
            text-align: left;
            height: 2rem;
            box-sizing: content-box;
            border-bottom: 1px solid lightgrey;
            padding-left: 0.5rem;
        }

        .status_bar .msg {
            border-radius: 12px;
            margin: 4px 1rem 0 0;
            display: inline-block;
            padding: 4px 0.5rem;
            background-color: #17a2b8;
            color: white;
        }

        .status_bar .error {
            background-color: #dc3545;
            color: #fff;
        }

        .status_bar .warning {
            background-color: #ffc107;
            color: #212529;
        }

        .status_bar .success {
            color: #fff;
            background-color: #28a745;
        }

        .bookmark {
            overflow: auto;
            max-height: 100%;
            list-style-type: decimal;
            margin: 0;
        }

        .bookmark .line {
            white-space: nowrap;
        }

        .bookmark li {
            padding: 0.6rem;
        }

        .bookmark a {
            display: inline-block;
        }

        .password_box {
            overflow: auto;
            max-height: 100%;
            margin: 0;
        }

        .password_box .line {
            line-height: 3rem;
        }

        .password_box .space {
            margin-right: 2rem;
        }

        .password_box p.is_url {
            font-weight: bold;
        }

        .password_box a.is_key {
            display: inline-block;
            margin-left: 1rem;
        }

        .no_match {
            display: none;
        }

        .block {
            display: block;
        }

        button.danger {
            border: 1px solid #dc3545;
            background-color: #dc3545;
            color: #fff;
        }

        button.warning {
            border: 1px solid #ffc107;
            background-color: #ffc107;
            color: #212529;
        }


        button.sec {
            border: 1px solid #6c757d;
            background-color: #6c757d;
            color: #fff;
        }

        hr.full {
            margin: 0;
            padding: 0;
            display: block;
            overflow: hidden;
            visibility: hidden;
            height: 1px;
        }
    </style>
</head>
<body>
<div id="body">
    <status_bar ref="status_bar"></status_bar>
    <bookmark_list ref="bookmark_list"></bookmark_list>
    <password_list ref="password_list"></password_list>
    <more_list ref="more_list"></more_list>
    <nav_bar ref="nav_bar"></nav_bar>
    <component v-bind:is="float_div" ref="float_div">
        <!--æ ¹æ®çˆ¶ç»„ä»¶data.float_div =å·²å…¨å±€æ³¨å†Œç»„ä»¶åæˆ–ç»„ä»¶{}åŠ¨æ€åˆ›å»º-->
    </component>
</div>

<script type="text/html" id="status_bar_tpl">
    <div class="status_bar" id="status_bar">
        <template v-for="obj in msg">
            <b :class="'msg ' + obj.color">{{obj.txt}}</b>
        </template>
    </div>
</script>

<script type="text/html" id="bookmark_list_tpl">
    <ol v-show="show" class="bookmark">
        <template v-for="(url, index) in list">
            <li :key="url" class="filter_item">
                <a target="_blank" @contextmenu.stop.prevent.self="bookmark_edit(url,$event)"
                   :href="url">
                    {{G.D.bookmark[url]}}
                </a>
            </li>
        </template>
    </ol>
</script>

<script type="text/html" id="password_list_tpl">
    <ol v-show="show" class="password_box" style="list-style-type: simp-chinese-informal;">

        <template v-for="(array,index) in list">
            <li :key="index" class="line filter_item">
                <p class="is_url">
                    <a :href="'http://' + G.D.password[array[0]].url" target="_blank">{{G.D.password[array[0]].url}}</a>
                </p>
                <ol>
                    <template v-for="(key, index) in array">
                        <li>
                            <a
                                    class="is_key space"
                                    @contextmenu.stop.prevent="password_edit(key,$event)"
                                    @click="password_copy_password(key)" href="javascript:void(0);">ğŸ”‘</a>
                            <a @click="password_copy_name(key)" class="space" href="javascript:void(0);">
                                {{G.D.password[key].user}}
                            </a>
                            <sup class="space">({{G.D.password[key].name}})</sup>
                        </li>
                    </template>
                </ol>
            </li>
        </template>

    </ol>
</script>

<script type="text/html" id="more_list_tpl">
    <div v-show="show" class="more_box">

        <template v-for="obj in list">
            <p>
                <button @click="obj.click($root)">{{obj.text}}</button>
            </p>
        </template>

    </div>
</script>

<script type="text/html" id="nav_bar_tpl">
    <div class="nav_bar">

        <input
                v-show="!show_more_box"
                onclick="this.select();" v-model="filter_key_word"
                class="search_url split"
                placeholder="ç­›æŸ¥">

        <button v-show="show_bookmark_box"
                class="split " @click="new_bookmark">æ·»ä¹¦ç­¾
        </button>

        <button @click="new_password" class="split" v-show="show_password_box">æ·»å¯†ç </button>

        <button
                class="split "
                @click="box_switch"
                v-show="!show_more_box"
        >
            {{show_password_box?'çœ‹ä¹¦ç­¾':'çœ‹å¯†ç '}}
        </button>

        <button @click="box_switch('more')" class="split ">
            {{show_more_box?'âœ–':'â˜°'}}
        </button>
    </div>
</script>

<script type="text/html" id="float_div_tpl">
    <div class="float_div" v-show="show" @click.self.stop="hide_me($root,$event)">
        <div class="holder_line">
            <div class="body"
                 :style="'max-height: ' + ($root.window_height - $root.status_height) + 'px;max-width:' + $root.window_width + 'px;'">
                <div class="title">{{title}}</div>
                <div class="content">
                    <!--è¿™é‡Œä¸èƒ½ç”¨templateæ ‡ç­¾,å› ä¸ºvueæ˜¯å¯¹è¿™ä¸ªdomä½¿ç”¨innerHTML-->
                    <div v-html="form"></div>
                </div>
                <div class="buttons">
                    <div :class="'msg ' + msg_cls">{{msg}}</div>
                    <template v-for="(b,index) in button">
                        <button :class="b.class + ' float_btn'"
                                @click="click_btn(index,$event)"
                        >
                            {{b.text}}
                        </button>
                    </template>
                </div>
            </div>
        </div>
    </div>
</script>


<script type="text/html" id="preview_password_tpl">
    <div class="edit_title">ç™»å½•å¯†ç ï¼š</div>
    <textarea class="editable" placeholder="è¿™æ˜¯è§£å¼€åçš„å¯†ç " readonly="readonly" v-model.trim.lazy="form.password"
              rows="10"></textarea>

    <div class="edit_title">æ—§ä¸»å¯†ç ï¼š</div>
    <input class="editable" :placeholder="form.master_tip" type="password" v-model.trim.lazy="form.master">
</script>


<script type="text/html" id="edit_bookmark_tpl">
    <div class="edit_title">ä¹¦ç­¾åç§°ï¼š</div>
    <input class="editable" placeholder="è¾“å…¥åç§°" v-model.trim.lazy="form.name"/>
    <div class="edit_title">ä¹¦ç­¾ç½‘å€ï¼š</div>
    <input type="url" class="editable" placeholder="è¾“å…¥ç½‘å€" v-model.trim.lazy="form.url"/>
    <div class="edit_title">
        <label v-show="form.is_edit"><input type="checkbox" v-model.trim.lazy="form.delete_allow"/> åŒæ„åˆ é™¤</label>
    </div>
</script>

<script type="text/html" id="edit_password_tpl">
    <div class="edit_title">ç™»å½•ç½‘å€ï¼š</div>
    <input class="editable" type="url" placeholder="è¯·è¾“å…¥ç½‘å€" v-model.trim.lazy="form.url">

    <div class="edit_title">ç™»å½•ç”¨æˆ·ï¼š</div>
    <input class="editable" placeholder="è¯·è¾“å…¥ç™»å½•ç”¨æˆ·å" v-model.trim.lazy="form.user">

    <div class="edit_title">ç™»å½•å¯†ç ï¼š</div>
    <textarea class="editable" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç " v-model.trim.lazy="form.password"
              rows="10"
    ></textarea>

    <div class="edit_title">æ¡ç›®ç®€è¿°ï¼š</div>
    <input class="editable" placeholder="è¯·è¾“å…¥æœ¬æ¡ç›®ç”¨é€”" v-model.trim.lazy="form.name">

    <template v-show="form.old_master_show">
        <div class="edit_title">æ—§ä¸»å¯†ç ï¼š</div>
        <input class="editable" type="password" :placeholder="form.old_master_tip" v-model.trim.lazy="form.old_master">
    </template>

    <div class="edit_title">ä¸»å¯†å¤‡å¿˜ï¼š</div>
    <input class="editable" placeholder="ç”¨æ¥è¿½å¿†ä¸»å¯†ç " v-model.trim.lazy="form.master_tip">

    <div class="edit_title">æ–°ä¸»å¯†ç ï¼š</div>
    <input class="editable" placeholder="ç”¨æ¥ä¿æŠ¤æ‰€æœ‰å¯†ç çš„" v-model.trim.lazy="form.master">

    <div class="edit_title">
        <label>
            <input v-model.trim.lazy="form.over" type="checkbox">
            è¦†ç›–æ—§çš„
        </label>
        <label v-show="form.is_edit">
            <input type="checkbox" v-model.trim.lazy="form.delete_allow"/>
            åˆ é™¤æœ¬æ¡
        </label>
    </div>

</script>

<script>
    +function () {
        "use strict";

        if (!function (ls) {
            for (let t in ls) {
                if (ls[t]) {
                    document.body.innerText = t;
                    return false;
                }
            }

            return true;
        }({
            'æµè§ˆå™¨ä¸æ”¯æŒJSONï¼Œæ— æ³•ä½¿ç”¨': !window.JSON,
            // aes 5ç§æ¨¡å¼è¯´æ˜ https://blog.csdn.net/xiaowang627/article/details/56270206
            // è§ https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto
            'æµè§ˆå™¨ä¸æ”¯æŒåŠ å¯†ï¼Œæ— æ³•ä½¿ç”¨': !window.crypto,
            // å› ä¸ºç²˜è´´ä¹‹ç±»åŠŸèƒ½å…¶å®ƒæµè§ˆå™¨ä¸æ”¯æŒï¼Œæˆ–æ˜¯å…¶å®ƒæµè§ˆå™¨åŠ å…¥å…¶å®ƒé¢å¤–åŠŸèƒ½
            'ä»…æ”¯æŒchromeæµè§ˆå™¨': "Google Inc." !== navigator.vendor
        })) return;

        // vueçš„è®¡ç®—å¼•ç”¨åˆ°å®ƒæ—¶ï¼Œæ˜¯é€šè¿‡å¼•ç”¨æ–¹å¼æ¥ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™å…¶å®ƒä½ç½®ä¿®æ”¹å®ƒçš„å€¼æ—¶ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹åˆ°vueè®¡ç®—æ–¹å¼å¼•ç”¨è¿‡å»çš„åœ°å€ä¸Šå˜é‡
        let G = {D: {empty: true}};
        console.log(G);

        window.onbeforeunload = function (e) {
            if (G.D.empty) return; true;

            e = e || window.event;

            // å…¼å®¹IE8å’ŒFirefox 4ä¹‹å‰çš„ç‰ˆæœ¬
            if (e) {
                e.returnValue = 'æ‚¨ä¿å­˜æ•°æ®äº†å—ï¼Ÿ';
            }

            // Chrome, Safari, Firefox 4+, Opera 12+ , IE 9+
            return 'æ‚¨ä¿å­˜æ•°æ®äº†å—ï¼Ÿ';
        };

        /**
         *
         * æ³¨æ„ vueæ˜¯ä¸€ä¸ªå®ä¾‹çš„dataä»»æ„å±æ€§å˜åŒ–ï¼Œå°±ä¼šæŠŠæ•´ä¸ªå®ä¾‹çš„elæ¸²æŸ“ä¸€æ¬¡ï¼Œå¹¶éæƒ³åƒé‚£æ ·ï¼Œåªæ›´æ–°ç”¨åˆ°è¿™ä¸ªå±æ€§çš„é‚£éƒ¨åˆ†ui
         * æ‰€ä»¥ï¼Œè¦æ‹†ç»†
         * @var {Function} Vue
         *
         */
        Vue.filter('v_html', function (value) {
            console.log(value);
            return value.replace(/&lt;/g, '>').replace(/&gt;/g, '>');
        });

        Vue['component']('status_bar', {
            template: '#status_bar_tpl',
            data: function () {
                return {
                    delay: 5,
                    msg: []
                };
            },
            created: function () {
                this.success('åˆå§‹å®Œæˆ');
                this['$root']['$on']('error', this.error);
                this['$root']['$on']('warning', this.warning);
                this['$root']['$on']('success', this.success);
            },
            mounted: function () {
                this['$root'].status_height = document.getElementById('status_bar').offsetHeight;
            },
            methods: {
                error: function (txt) {
                    return this.add(txt, 'error');
                },

                warning: function (txt) {
                    return this.add(txt, 'warning');
                },

                success: function (txt) {
                    return this.add(txt, 'success');
                },

                add: function (txt, color) {
                    let th = this;
                    // æ·»åŠ åœ¨å‰é¢
                    this.msg.unshift({
                        color: color,
                        txt: txt
                    });
                    setTimeout(function () {
                        th.msg.pop();
                    }, 1000 * this.delay);
                }
            }
        });

        Vue['component']('bookmark_list', {
            template: '#bookmark_list_tpl',
            data: function () {
                return {
                    list: [],
                    show: false,
                    update: 0
                };
            },
            created: function () {
                this['$root']['$on']('new_bookmark', this.bookmark_edit);
                this['$root']['$on']('G.D.update', this.bookmark_sort);
            },
            computed: {
                // åªè¯»å±æ€§
                G: function () {
                    return G;
                }
            },
            methods: {
                /** æ·»åŠ /ä¿®æ”¹ä¹¦ç­¾*/
                bookmark_edit: function (key) {
                    let self = this;
                    let is_edit = key;
                    let title = is_edit ? 'ç¼–è¾‘ä¹¦ç­¾' : 'æ·»åŠ ä¹¦ç­¾';
                    let form = {
                        name: is_edit ? G.D.bookmark[key] : '',
                        url: is_edit ? key : '',
                        delete_allow: false,
                        is_edit: is_edit,
                    };
                    let buttons = [
                        {
                            text: 'ä¿å­˜',
                            click: function () {
                                let float = this;
                                let name = float.form.name;
                                let url = float.form.url;

                                if ('' === name) {
                                    this.error('åç§°ä¸èƒ½ç•™ç©º');
                                    return;
                                }

                                if ('' === url) {
                                    this.error('ç½‘å€ä¸èƒ½ç•™ç©º');
                                    return;
                                }

                                if (!/^\w+:.+/.test(url)) {
                                    this.error('ç½‘å€æ— æ•ˆ');
                                    return;
                                }

                                if (!G.D.bookmark) G.D.bookmark = {};
                                G.D.bookmark[url] = name;
                                this.show = false;
                                this['$root']['$emit']('success', 'å·²æ›´æ–°');
                                self.bookmark_sort();
                            }
                        },
                    ];

                    if (is_edit) {
                        buttons.push(
                            {
                                'text': 'å¤åˆ¶',
                                click: function () {
                                    // æ”¾å…¥å‰ªè´´æ¿
                                    let float = this;
                                    this['$root'].copy(
                                        key + '#' + G.D.bookmark[key],
                                        (ok, err) => {
                                            if (ok) {
                                                float.show = false;
                                                return;
                                            }

                                            float.error('æ— æ³•å¤åˆ¶ï¼š' + err);
                                        }
                                    );
                                }
                            },
                            {
                                class: 'danger',
                                'text': 'åˆ é™¤',
                                click: function () {
                                    let float = this;

                                    if (!float.form.delete_allow) {
                                        this.error('è¯·å…ˆå‹¾é€‰ - å…è®¸åˆ é™¤');
                                        return;
                                    }

                                    if (!G.D.bookmark || !G.D.bookmark[key]) {
                                        this.error('ä¹¦ç­¾ä¸å­˜åœ¨');
                                        return;
                                    }

                                    delete G.D.bookmark[key];
                                    this['$root']['$emit']('success', 'åˆ é™¤æˆåŠŸ');
                                    this['$root']['$emit']('G.D.update');
                                    this.show = false;
                                }
                            });
                    }

                    app.show_float_div(title, form, buttons, 'edit_bookmark_tpl');
                },

                /** å¯¹ä¹¦ç­¾æ’åº*/
                bookmark_sort: function () {
                    if (!G.D.bookmark) return;
                    let keys = Object.keys(G.D.bookmark);
                    keys.sort(function (a, b) {
                        // æŒ‰åç§°é¡ºåº
                        return a.localeCompare(b);
                    });
                    // å¦‚æœåªä¿®æ”¹nameï¼Œkeyå°±ä¼šç›¸åŒ
                    this['$set'](this, 'list', keys);
                    ++this.update;
                }
            }
        });

        Vue['component']('password_list', {
            template: '#password_list_tpl',
            data: function () {
                return {
                    list: [],
                    show: false,
                    update: 0
                };
            },
            created: function () {
                this['$root']['$on']('new_password', this.password_edit);
                this['$root']['$on']('G.D.update', this.password_sort);
            },
            computed: {
                // åªè¯»å±æ€§ TODO è¿™ä¸ªå¥½åƒåªåˆå§‹ä¸€æ¬¡ï¼Œå¹¶éæ¯æ¬¡è°ƒç”¨æ—¶ï¼Œéƒ½å–
                G: function () {
                    return G;
                }
            },
            methods: {
                string_to_id: function (str) {
                    return this['$root'].string_to_id(str);
                },
                /** å¯†ç æ’åº*/
                password_sort: function () {
                    if (!G.D.password) return;
                    let keys = Object.keys(G.D.password);
                    keys.sort(function (a, b) {
                        /*æŒ‰ç½‘å€>ç”¨æˆ·åé¡ºåº*/
                        return a.localeCompare(b);
                    });
                    let list = [];
                    let tmp = [];
                    keys.forEach(function (v) {
                        if (!tmp.length || G.D.password[tmp[0]].url === G.D.password[v].url) {
                            tmp.push(v);
                            return;
                        }

                        list.push(tmp);
                        tmp = [v];
                    });
                    list.push(tmp);
                    // æ¯”å¦‚åªè°ƒæ•´äº†å¤‡å¿˜çš„å€¼ï¼Œé‚£ä¹ˆå®ƒçš„keyå°±ä¼šç›¸åŒï¼Œvueå°±ä¸ä¼šæ›´æ–°ï¼Œæ‰€ä»¥ï¼Œè¦æ›´æ–°update
                    this['$set'](this, 'list', list);
                    ++this.update;
                },
                password_edit: async function (key) {
                    let self = this;
                    let is_empty = function () {
                        if (!G.D.password) return true;

                        for (let i in G.D.password) {
                            // åªè¦æœ‰ä¸€ä¸ªä¸ªå°±éç©º
                            if ('string' === typeof i)
                                return false;
                        }

                        return true;
                    }();
                    let is_edit = key;
                    let title = is_edit ? 'ç¼–è¾‘å¯†ç ' : 'æ·»åŠ å¯†ç ';
                    let form = {
                        name: is_edit ? G.D.password[key].name : '',
                        url: is_edit ? G.D.password[key].url : '',
                        user: is_edit ? G.D.password[key].user : '',
                        password: '',
                        master_tip: '',
                        master: '',
                        over: false,
                        is_edit: is_edit,
                        old_master: '',
                        // åªè¦å·²æœ‰å¯†ç æ¡ç›®ï¼Œæ—§ä¸»å¯†ç è¾“å…¥å°±è¦æ˜¾ç¤º
                        old_master_show: !is_empty,
                        old_master_tip: !is_empty ? G.D.master_password_tip : '',
                        delete_allow: false,// é»˜è®¤ä¸å…è®¸åˆ é™¤
                        decode_old_password: false
                    };

                    if (is_edit) {
                        if (!G.D.password) {
                            this['$root'].error('æ•°æ®æŸå');
                            return;
                        }
                    }

                    let buttons = [
                        {
                            text: 'ä¿å­˜',
                            click: function () {
                                edit_action['call'](this, 'save');
                            }
                        }
                    ];

                    if (is_edit) {
                        buttons.unshift(
                            {
                                text: 'è§£å¼€',
                                click: async function () {
                                    if (!this.form.old_master) {
                                        this.error('è¯·è¾“å…¥åŸä¸»å¯†ç ');
                                        return;
                                    }

                                    let password = await self.decrypt(
                                        self.mix_master_password(this.form.old_master, this.form.url, this.form.user, this.form.name),
                                        G.D.password[key].password,
                                        G.D
                                    );

                                    if (!password) {
                                        this.error('æœªèƒ½è§£å¼€å¯†ç ï¼Œè¯·é‡è¯•');
                                        return;
                                    }

                                    this.success('å·²è§£å¼€');
                                    this.form.password = password;
                                    this.form.decode_old_password = true;
                                }
                            }
                        );

                        buttons.push({
                            class: 'danger',
                            text: 'åˆ é™¤',
                            click: function () {
                                edit_action['call'](this, 'del');
                            }
                        });
                    }

                    this['$root'].show_float_div(title, form, buttons, 'edit_password_tpl');

                    function update_info(data_clone) {
                        // æ›´æ–°æ—¶é—´æˆ³,è§¦å‘æç¤ºä¿å­˜
                        data_clone.update_human = new Date().toLocaleString();
                        // è®°å½•æ›´æ–°ç”¨æˆ·è®¾å¤‡
                        data_clone.user_agent = navigator.userAgent;
                        data_clone.platform = navigator.platform;
                    }

                    // åˆ é™¤æˆ–æ˜¯ç¼–è¾‘çš„å®æ“
                    async function edit_action(how) {
                        let float = this;
                        let is_del = 'del' === how;
                        let url = float.form.url;
                        let user = float.form.user;
                        let over = float.form.over;
                        let name = float.form.name;
                        let password = float.form.password;
                        let master_tip = float.form.master_tip;
                        let master = float.form.master;

                        if (is_del) {
                            if (!float.form.delete_allow) {
                                this.error('è¯·å…ˆå‹¾é€‰ - åŒæ„åˆ é™¤');
                                return;
                            }

                            if (!G.D.password[key]) {
                                this.error('æ¡ç›®ä¸å­˜åœ¨');
                                return;
                            }

                            // å®ƒæ€»æ˜¯è¿”å›true
                            delete G.D.password[key];
                            update_info(G.D);
                            this['$root'].success('æ›´æ–°å®Œæˆï¼Œè¯·åŠæ—¶å¯¼å‡ºä¿å­˜');
                            this.show = false;
                            this['$root']['$emit']('G.D.update');
                            // åˆ é™¤åªéœ€è¦åˆ é™¤æ¡ç›®å³å¯
                            return true;
                        }


                        if ('' === url) {
                            this.error('ç½‘å€æœªå¡«');
                            return;
                        }

                        if ('' === user) {
                            this.error('ç”¨æˆ·æœªå¡«');
                            return;
                        }


                        if (is_edit) {
                            if (!this.form.decode_old_password) {
                                // æœªè§£å¼€è¿‡å¯†ç ï¼Œä¸è®©ä¿å­˜ï¼Œé˜²æ­¢å¼„ä¸¢äº†æ—§å¯†ç ï¼Œåªèƒ½åœ¨å®ƒçš„åŸºç¡€ä¸Šä¿®æ”¹
                                this.error('è¯·å…ˆè§£å¼€æ—§å¯†ç å†ä¿®æ”¹');
                                return;
                            }
                        }

                        if ('' === password) {
                            this.error('ç™»å½•å¯†ç æœªå¡«');
                            return;
                        }

                        if ('' === name) {
                            this.error('æ¡ç›®ç®€è¿°æœªå¡«');
                            return;
                        }

                        if (!is_empty) {
                            // ä¸€å®šè¦æ—§ä¸»å¯†ç æ¥è§£å¼€
                            if ('' === float.form.old_master) {
                                this.error('æ—§ä¸»å¯†ç æœªå¡«');
                                return;
                            }
                        }


                        if ('' === master_tip) {
                            this.error('æ–°ä¸»å¯†ç å¤‡å¿˜æœªå¡«');
                            return;
                        }

                        if ('' === master) {
                            this.error('æ–°ä¸»å¯†ç æœªå¡«');
                            return;
                        }

                        // æŠŠç½‘å€å¤„ç†æˆåŸŸå
                        url = this['$root'].url_to_domain(url);
                        // å°è¯•å…‹éš†
                        let data_clone = JSON.parse(JSON.stringify(G.D));

                        if (!data_clone.password) data_clone.password = {};

                        if (data_clone.password[self.get_index(url, user)] && !over) {
                            this.error('ç½‘å€+ç”¨æˆ·ç›¸åŒçš„æ¡ç›®å·²å­˜åœ¨ï¼Œä¸”ç¦æ­¢è¦†ç›–');
                            return;
                        }

                        if (!is_empty) {
                            /** éœ€è¦æŠŠæ‰€æœ‰å¯†ç è§£å‡ºæ¥ï¼Œå› ä¸ºéœ€è¦ä¿è¯æ‰€æœ‰å¯†ç ä½¿ç”¨ç›¸åŒæ–¹å¼åŠ å¯†
                             */
                            this.error('æ­£åœ¨è§£å¼€æ‰€æœ‰å¯†ç ...');

                            for (let url_user in data_clone.password) {
                                if (!this.form.old_master) {
                                    this.error('åŸä¸»å¯†ç å¿…é¡»æä¾›');
                                    return;
                                }

                                let data = data_clone.password['' + url_user];
                                let plain_pwd = await self.decrypt(
                                    self.mix_master_password(this.form.old_master, data.url, data.user, data.name),
                                    data.password,
                                    data_clone
                                );

                                if (!plain_pwd) {
                                    this.error('è§£å¼€å¯†ç å¤±è´¥ï¼Œå¯èƒ½æ—§ä¸»å¯†ç æœ‰è¯¯');
                                    return;
                                }

                                // å› ä¸ºè¿™æ˜¯å…‹éš†åçš„å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œå°±ç®—è¿™è½®æœ‰é—®é¢˜ï¼Œä¹Ÿä¸ä¼šå½±å“
                                data.password = plain_pwd;
                            }

                            this.success('è§£å¼€å®Œæˆ');
                        }

                        // è‹¥å­˜åœ¨ç›´æ¥æ›¿æ¢
                        data_clone.password[self.get_index(url, user)] = {
                            url: url,
                            user: user,
                            password: password,
                            name: name
                        };


                        self['encrypt_random'](data_clone);
                        this.notice('æ­£åœ¨é‡æ–°åŠ å¯†æ‰€æœ‰å¯†ç ...');
                        // é‡æ–°åŠ å¯†æ‰€æœ‰å¯†ç ï¼Œä¸åŠ å¯†åŸŸåï¼Œç”¨æˆ·ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹
                        for (let url_user in data_clone.password) {
                            /** @var {Object} url_data */
                            let data = data_clone.password['' + url_user];
                            // åªåŠ å¯†å¯†ç 
                            let cipher_text = await self.encrypt(
                                self['mix_master_password'](master, data.url, data.user, data.name),
                                data.password, data_clone
                            );

                            if (!cipher_text) {
                                // åŠ å¯†ä¸­æ­¢
                                this.error('åŠ å¯†å¤±è´¥');
                                return;
                            }

                            data.password = cipher_text;
                        }

                        update_info(data_clone);
                        data_clone.master_password_tip = master_tip;
                        // æŠŠæ–°å¯¹è±¡æ”¾å…¥ï¼Œé€šè¿‡å°è¯•å…‹éš†æ–¹å¼ï¼Œä¸æ˜¯å¼•ç”¨
                        G.D = JSON.parse(JSON.stringify(data_clone));
                        this['$root'].success('æ›´æ–°å®Œæˆï¼Œè¯·åŠæ—¶å¯¼å‡ºä¿å­˜');
                        this.show = false;
                        this['$root']['$emit']('G.D.update');
                    }
                },

                'password_copy_name': function (key) {
                    // ç‚¹å‡»çš„æ˜¯ç”¨æˆ·å
                    this['$root'].copy(G.D.password[key].user);
                },

                //ç‚¹å‡»å¯†ç 
                'password_copy_password': function (key) {
                    let url = G.D.password[key].url;
                    let user = G.D.password[key].user;
                    let name = G.D.password[key].name;
                    let form = {
                        master_tip: G.D.master_password_tip,
                        password: '',
                        master: ''
                    };
                    let old_password = '';
                    let self = this;
                    this['$root'].show_float_div('é¢„è§ˆå¯†ç ', form, [
                        {
                            text: 'è§£å¼€',
                            click: async function () {
                                if (!this.form.master) {
                                    this.error('è¯·è¾“å…¥åŸä¸»å¯†ç ');
                                    return;
                                }

                                old_password = await self.decrypt(
                                    self.mix_master_password(this.form.master, url, user, name),
                                    G.D.password[key].password,
                                    G.D
                                );

                                if (!old_password) {
                                    this.error('æœªèƒ½è§£å¼€å¯†ç ï¼Œè¯·é‡è¯•');
                                    return;
                                }

                                this.success('å·²è§£å¼€');
                                this.form.password = old_password;
                            }
                        },
                        {
                            text: 'å¤åˆ¶',
                            click: function () {
                                if (!old_password) {
                                    this.error('è¯·å…ˆè§£å¼€å¯†ç ');
                                    return;
                                }

                                this['$root'].copy(old_password);
                            }
                        }
                    ], 'preview_password_tpl');
                },
                get_index: function (url, user) {
                    // é˜²æ­¢å‡ºç° ab+ac ä¸ a +bac ç›¸åŒçš„æƒ…å†µ
                    return url + '+' + user;
                },
                mix_master_password: function (master_password, url, user, name) {
                    // æ³¨æ„é¡ºåºä¸å…è®¸è°ƒæ•´ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´ä¸å…¼å®¹å‰é¢æ•°æ®
                    return master_password + url + user + name;
                },

                get_key: async function (password, salt) {
                    /** ç­‰å¾…è¿”å›å†ä¸‹æ¡è¯­å¥**/
                    let key = await window.crypto.subtle['importKey'](
                        "raw",
                        new TextEncoder().encode(password),
                        {name: "PBKDF2"},
                        /* æ˜¯å¦å¯å¯¼å‡º,PBKDF2å¿…é¡»è®¾ç½®æˆfalse*/
                        false,
                        ["deriveKey"]
                    );

                    if (!key || 'CryptoKey' !== this.type_of(key)) return false;
                    /** ç­‰å¾…è¿”å›å†ä¸‹æ¡è¯­å¥**/
                    key = await window.crypto.subtle.deriveKey(
                        {
                            "name": "PBKDF2",
                            salt: salt,
                            "iterations": 1000000,
                            "hash": "SHA-512"
                        }, key,
                        /*é•¿åº¦ä»…å…è®¸128æˆ–256*/
                        {name: "AES-CBC", length: 256},
                        true,
                        ["encrypt", "decrypt"]
                    );

                    return !key || 'CryptoKey' !== this.type_of(key) ? false : key;
                },

                /**
                 * æ”¹å˜jsonä¸­åŠ å¯†çš„éšæœºæ•°æ®ï¼›æ³¨æ„æ˜¯ç›´æ¥ä¿®æ”¹json
                 * @param {Object} data_json
                 */
                encrypt_random: function (data_json) {
                    data_json.key_salt_array = Array.from(window.crypto.getRandomValues(new Uint32Array(100)));
                    /*è¿™ä¸ªå¿…é¡»æ˜¯è®¾å®š16bytes,å¦‚int8*16ï¼Œint32*4*/
                    data_json.iv_array = Array.from(window.crypto.getRandomValues(new Uint8Array(16)));
                },

                encrypt: async function (password, plain_text, data_json) {
                    let key;

                    try {
                        key = await this.get_key(
                            password,
                            Uint32Array.from(data_json.key_salt_array)
                        );

                        if (null === key) {
                            this['$root'].error('æ“ä½œè¢«å–æ¶ˆ');
                            return null;
                        }

                        if (false === key) {
                            this['$root'].error('è·å–å¯†ç å‡ºé”™');
                            return false;
                        }
                    } catch (e) {
                        this['$root'].error('è·å–ä¸»å¯†ç å¤±è´¥ï¼š' + e);
                        return false;
                    }

                    try {
                        /**å¯†æ–‡,è¿”å›çš„æ˜¯ArrayBufferäºŒè¿›åˆ¶
                         *@return {ArrayBuffer} */
                        let cipher_text = await window.crypto.subtle.encrypt(
                            {
                                name: "AES-CBC",
                                /*è¿™ä¸ªå¿…é¡»æ˜¯è®¾å®š16bytes,å¦‚int8*16ï¼Œint32*4*/
                                iv: Uint8Array.from(data_json.iv_array)
                            },
                            key,
                            new TextEncoder().encode(plain_text)
                        );

                        if (!cipher_text) {
                            this['$root'].error('æ— æ³•åŠ å¯†');
                            return false;
                        }

                        return Array.from(new Uint32Array(cipher_text));
                    } catch (e) {
                        this['$root'].error('åŠ å¯†å¤±è´¥ï¼š' + e);
                    }

                    return false;
                },

                /**
                 * è§£å¯†
                 * @param {String} password
                 * @param  cipher_text
                 * @param {Object} data_json
                 * @return {Promise<string|boolean>}
                 */
                decrypt: async function (password, cipher_text, data_json) {
                    if ('Array' !== this.type_of(cipher_text))
                        return false;
                    let key;

                    try {
                        key = await this.get_key(password, Uint32Array.from(data_json.key_salt_array));

                        if (null === key) {
                            this['$root'].error('æ“ä½œè¢«å–æ¶ˆ');
                            return null;
                        }

                        if (false === key) {
                            this['$root'].error('è·å–å¯†ç å‡ºé”™');
                            return false;
                        }
                    } catch (e) {
                        this['$root'].error('è·å–ä¸»å¯†ç å¤±è´¥ï¼š' + e);
                        return false;
                    }

                    if (!key) return false;
                    let iv = Uint8Array.from(data_json.iv_array);
                    cipher_text = Uint32Array.from(cipher_text).buffer;
                    let result;

                    try {
                        result = await window.crypto.subtle.decrypt(
                            {
                                name: "AES-CBC",
                                iv: iv
                            },
                            key,
                            cipher_text
                        );
                    } catch (e) {
                        this['$root'].error('è§£å¯†å¤±è´¥ï¼š' + e);
                        return false;
                    }

                    if (!result || 'ArrayBuffer' !== this.type_of(result)) return false;
                    return new TextDecoder().decode(result);
                },

                type_of: function (o) {
                    return Object.prototype.toString.call(o).split(' ')[1]
                        .replace(']', '');
                }
            }
        });

        Vue['component']('more_list', {
            template: '#more_list_tpl',
            data: function () {
                return {
                    list: [
                        {
                            text: 'å¯¼å…¥',
                            click: function ($root) {
                                let input = document.getElementById('file');

                                if (input) {
                                    input.onchange = null;
                                    input.remove();
                                }

                                input = document.createElement('INPUT');
                                input.type = 'file';
                                input.name = 'file';
                                // chromeåœ¨æ¯”è¾ƒå¤šçš„æ–‡ä»¶ç›®å½•ä¸­æ‰“å¼€æ—¶ä¼šæ¯”è¾ƒå¡
                                input.setAttribute('accept', "application/json");
                                input.style.display = 'none';
                                input.id = 'file';
                                input.onchange = function () {
                                    if (!this.files.length) {
                                        return false;
                                    }

                                    let file = this.files[0];

                                    if (!/.+\.json$/.test(file.name)) {
                                        $root.error('å¿…é¡»æ˜¯.jsonæ ¼å¼æ–‡ä»¶');
                                        return;
                                    }

                                    if (!file.size) {
                                        $root.error('æ— æ•ˆæ–‡ä»¶');
                                        return;
                                    }

                                    let reader = new FileReader();
                                    reader.onerror = function (event) {
                                        $root.error('è¯»å–å†…å®¹å¤±è´¥:' + event.target['error']);
                                    };
                                    reader.onload = function (event) {
                                        let text = event.target['result'];

                                        function set_json(t) {
                                            try {
                                                if (!JSON.parse(t))
                                                    $root.error('æ— æ³•å¯¼å…¥ï¼šè§£æå¤±è´¥');
                                                // ä¸è¦å¼•ç”¨çš„æ–¹å¼
                                                G.D = JSON.parse(t);
                                                $root['$emit']('G.D.update');
                                                $root.success('å¯¼å…¥æˆåŠŸ');
                                                $root['$refs']['nav_bar']['box_switch']('more');
                                            } catch (e) {
                                                $root.error('è§£ææ•°æ®å‡ºé”™ï¼š' + e);
                                            }
                                        }

                                        if (G.D.empty) {
                                            // ç©ºçš„ï¼Œä¸ç”¨æé†’
                                            set_json(text);
                                            return;
                                        }

                                        $root['show_float_div'](
                                            'æ“ä½œç¡®è®¤å¯¹è¯æ¡†',
                                            '<div class="text">æ‚¨ç¡®è®¤è¦æ›¿æ¢å½“å‰æ•°æ®å—ï¼Ÿ</div>',
                                            [{
                                                class: 'danger',
                                                text: 'ç¡®è®¤',
                                                click: function () {
                                                    set_json(text);
                                                    this.show = false;
                                                }
                                            }]
                                        );
                                    };
                                    reader.readAsText(file, 'utf-8');
                                };
                                document.body.appendChild(input);
                                input.click();
                            }
                        },
                        {
                            text: 'å¯¼å‡º',
                            click: function ($root) {
                                let data = JSON.stringify(G.D, null, 4);

                                if (/^\s*$|^{}$/.test(data)) {
                                    $root.success('æš‚æ— æ•°æ®');
                                    return;
                                }


                                let a = document.createElement('a');
                                a.style.display = 'none';
                                let date = new Date();
                                let file_name = ''
                                    + String(date.getMilliseconds()).padStart(3, '0')
                                    + '.'
                                    + String(date.getSeconds()).padStart(2, '0')
                                    + '.'
                                    + String(date.getMinutes()).padStart(2, '0')
                                    + '.'
                                    + String(date.getHours()).padStart(2, '0')
                                    + ' '
                                    + String(date.getDate()).padStart(2, '0')
                                    + '.'
                                    + String(1 + date.getMonth()).padStart(2, '0')
                                    + '.'
                                    + date.getFullYear()
                                    + '.json';
                                a.setAttribute('download', file_name);
                                a.href = URL.createObjectURL(new Blob([data], {type: 'application/json'}));
                                document.body.appendChild(a);
                                a.click();

                                setTimeout(function () {
                                    // è¦ä¸»åŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢å ç”¨å†…å­˜
                                    URL.revokeObjectURL(a.href);
                                    a.remove();
                                    a = null;
                                }, 60 * 1000);
                            }
                        },
                        {
                            text: 'æ‰“å¼€å¾®äº‘',
                            click: function () {
                                window.open('https://www.weiyun.com/disk/', '_blank');
                            }
                        }
                    ],
                    show: true
                };
            },
            methods: {}
        });

        // ä¸‹æ–¹å¯¼èˆªvueå®ä¾‹
        Vue['component']('nav_bar', {
            template: '#nav_bar_tpl',
            data: function () {
                return {
                    // æ›´å¤šæ“ä½œé»˜è®¤ä¸æ˜¾ç¤º
                    show_more_box: true,
                    // å¯†ç åˆ—è¡¨é»˜è®¤ä¸æ˜¾ç¤º
                    show_password_box: false,
                    // ä¹¦ç­¾é»˜è®¤æ˜¾ç¤º
                    show_bookmark_box: false,
                    filter_key_word: ''
                };
            },
            watch: {
                // åŒæ­¥æ›´å¤šæ“ä½œvueå®ä¾‹çŠ¶æ€
                show_more_box: function (bool) {
                    this['$parent']['$refs']['more_list'].show = bool;
                },
                // åŒæ­¥å¯†ç åˆ—è¡¨vueå®ä¾‹çŠ¶æ€
                show_password_box: function (bool) {
                    this['$parent']['$refs']['password_list'].show = bool;
                },
                // åŒæ­¥ä¹¦ç­¾åˆ—è¡¨vueå®ä¾‹çŠ¶æ€
                show_bookmark_box: function (bool) {
                    this['$parent']['$refs']['bookmark_list'].show = bool;
                },
                'filter_key_word': function (val) {
                    let cls_found = 'no_match';
                    document.querySelectorAll('.' + cls_found)
                        .forEach(function (dom) {
                            dom.className = dom.className.replace(new RegExp('(^|\\s)' + cls_found + '(\\s|$)', 'g'), '');
                        });

                    document.querySelectorAll('.filter_item')
                        .forEach(function (dom) {
                            if (dom.innerText.indexOf(val) > -1) {
                                return;
                            }

                            // éšè—ä¸ç¬¦åˆçš„
                            dom.className += ' ' + cls_found;
                        });
                }
            },
            methods: {
                // åˆ‡æ¢ä¹¦ç­¾åˆ—è¡¨ã€å¯†ç åˆ—è¡¨ã€æ›´å¤šæ“ä½œ
                'box_switch': function (who) {
                    let show_name, th = this;

                    if ('more' === who) {
                        // ç‚¹å‡»äº†æ˜¾ç¤ºæ›´å¤šæŒ‰é’®
                        show_name = this.show_more_box ? 'show_bookmark_box' : 'show_more_box';
                    } else {
                        show_name = this.show_password_box ? 'show_bookmark_box' : 'show_password_box';
                    }

                    ['show_bookmark_box', 'show_password_box', 'show_more_box'].forEach(function (v) {
                        th[v] = v === show_name;
                    });
                },
                // æ–°å»ºä¹¦ç­¾
                'new_bookmark': function () {
                    this['$root']['$emit']('new_bookmark');
                },

                'new_password': function () {
                    this['$root']['$emit']('new_password');
                }
            }
        });

        /**
         * this['$refs']åªæœ‰åœ¨å­ç»„ä»¶createdæ—¶æ‰ä¼šç”Ÿæ•ˆï¼Œ
         * å®ƒå¹¶éæ˜¯ç­‰å­ç»„ä»¶åˆ›å»ºå¥½å†åˆ›å»ºvueå®ä¾‹,æ‰€ä»¥å¯èƒ½è¦è€ƒè™‘å›è°ƒæ–¹å¼æ¥å¤„ç†
         */
        let app = new Vue({
            el: '#body',
            data: {
                float_div: null,
                window_height: window.innerHeight,
                window_width: window.innerWidth,
                status_height: 0
            },
            /**
             * è¿™ä¸ªçŠ¶æ€ï¼Œæ— æ³•ä¿è¯this.$refs.float_divå­˜åœ¨
             */
            created: function () {
                let self = this;
                window.onresize = function () {
                    self.window_height = window.innerHeight;
                    self.window_width = window.innerWidth;
                };
            },
            methods: {
                console: function () {
                    console.log.apply(console, arguments);
                },
                trim: function (txt) {
                    return String(txt).replace(/^\s+|\s+$/g, '');
                },
                // ç½‘å€å¾—åˆ°åŸŸå
                url_to_domain: function (url) {
                    return this.trim(url).replace(/^[^:]*:\/*|[\/#?].*$/g, '');
                },

                string_to_id: function (string) {
                    return btoa(encodeURIComponent(string))
                        .replace(/\+/g, '_')
                        .replace(/\//g, '-')
                        .replace(/=/g, '');
                },
                error: function (txt) {
                    this['$emit']('error', txt);
                },
                notice: function (txt) {
                    this['$emit']('notice', txt);
                },
                success: function (txt) {
                    this['$emit']('success', txt);
                },
                copy: function (str, cb) {
                    let self = this;
                    // è¦æ˜¯äººå·¥æ²¡æœ‰ç‚¹å‡»bodyè·å¾—ç„¦ç‚¹å°±æ— æ³•å¤åˆ¶
                    navigator.clipboard["writeText"]('' + str)
                        .then(function () {
                            self['$emit']('success', 'å·²å¤åˆ¶');
                            cb && cb.call(self, true);
                        })
                        .catch(err => {
                            self['$emit']('error', 'æ— æ³•å¤åˆ¶ï¼š' + err);
                            cb && cb.call(self, false, err);
                        });
                },
                //åˆå§‹åŒ–æµ®å±‚çš„é…ç½®
                show_float_div: function (title, form, button, body_tpl_id, on_close) {
                    let tpl = document.getElementById('float_div_tpl').innerHTML;

                    if (body_tpl_id) {
                        body_tpl_id = document.getElementById(body_tpl_id);
                        // åˆå¹¶æ¨¡æ¿ï¼Œå› ä¸ºvueä¸æ”¯æŒåŠ¨æ€æ¸²æŸ“ã€‚åªèƒ½å®ä¾‹å‰å¤„ç†
                        tpl = tpl.replace(/<div\s+v-html="form">\s*<\/div>/, body_tpl_id.innerHTML);
                    }

                    if (!button) button = [];
                    button.push({
                        class: 'sec',
                        text: 'æ”¾å¼ƒ',
                        click: function () {
                            this.show = false;
                        }
                    });
                    this.float_div = {
                        template: tpl,
                        data: function () {
                            return {
                                title: title,
                                form: form,
                                button: button,
                                msg: null,
                                msg_cls: null,
                                show: true,
                                on_close: on_close
                            };
                        },
                        props: ['window_height', 'window_width'],
                        watch: {
                            // å…³é—­æ—¶ï¼Œæ‰§è¡Œæ”¶å°¾å·¥ä½œ
                            'show': function (show) {
                                if (!show) {
                                    // æœ‰å…³é—­å¤„ç†äº‹ä»¶
                                    this.on_close && this.on_close.call(this);
                                    // æ¸…ç†ç›¸å…³
                                    this.button = null;
                                    this.on_close = null;
                                    // åˆ é™¤æœ¬å®ä¾‹
                                    this['$root'].float_div = null;
                                }
                            }
                        },
                        methods: {
                            'hide_me': function () {
                                this.show = false;
                            },
                            'click_btn': function (index, e) {
                                let click = button[index].click;
                                click && click.call(this, e);
                            },
                            notice: function (html) {
                                this.show_msg(html, 'notice');
                            },
                            error: function (html) {
                                this.show_msg(html, 'error');
                            },
                            success: function (html) {
                                this.show_msg(html, 'success');
                            }, show_msg: function (html, cls) {
                                this['msg_cls'] = cls;
                                this.msg = html;
                            },
                        }
                    };
                    return this;
                }
            }
        });
    }();
</script>
</body>
</html>
